<div id="outer" class="relative w-screen min-h-screen bg-center bg-cover bg-no-repeat bg-[url('/media/norr.jpg')]">

	<div id="loading" class="items-center htmx-indicator flex justify-center fixed h-screen w-screen bg-black bg-opacity-25 top-0 right-0 z-50 " >
		<span  class="text-base-200 loading loading-spinner loading-lg"></span>
	</div>

	<div class="absolute inset-0 bg-black opacity-[30%]"></div>
	<img class="absolute top-0 h-full w-full z-0" src="/media/Vector 8.png" alt="Background image" />
	<div class="container relative mx-auto p-2 z-10 ">
		<h1 class="mt-16 text-3xl text-white font-bold">Intresseanmälan bostad</h1>
		<form hx-indicator="#loading" hx-post="/intrestreport/" hx-target="#outer" hx-swap="outerHTML" class="flex flex-col items-center gap-12" >
			<div  class="mt-2 flex flex-col md:grid grid-cols-2 grid-row-2 gap-16 mb-32 w-full ">

				<div class="order-2 md:order-1 cardcomp flex flex-col items-center gap-4 ">
					<h2 class="text-black text-2xl font-bold  " >Sökande</h2>
					<div class='w-full h-full grid grid-cols-2 gap-3 ' >
						<input class="input input-bordered" placeholder="Namn*" name="name" required/>
						<input type="text" id="personal-number" name="personal_number" placeholder="YYYYMMDDXXXX*" class="input input-bordered" pattern="\d{10}|\d{12}" required>
						<input class="input input-bordered col-span-2" placeholder="E-post*" name="email" type="email" required/>
						<input class="input input-bordered" placeholder="Nuvarande bostadsadress*" name="adress" required/>
						<input class="input input-bordered" placeholder="Nuvarande hyresvärd" name="landlord" />
						<input class="input input-bordered" placeholder="Syselsettning*" name="employment" required/>
						<input class="input input-bordered" placeholder="Arbetsgivare" name="employer" type="text" />
						<input class="input input-bordered" placeholder="Telefon*" name="phone" type="phonenumber" required/>
						<input class="input input-bordered" placeholder="Tel Arbetsgivare" name="phone_employer" type="text"/>
					</div>
				</div>

				<div class="order-1 md:order-2 text-white font-bold flex flex-col gap-3" >
					<p class="p-3 inset-0 drop-shadow-xl">Vi tillämpar inte något kösystem i formell  mening, men grundkravet är att samtliga gör en intresseanmälan. Vi  försöker prioritera de som sökt en längre tid hos oss. Det gäller dock  att du som intressent är aktiv i ditt sökande av lägenhet och förnyar  din intresseanmälan varje månadsskifte.</p>
					<p class="p-3 inset-0 drop-shadow-xl">För  att erhålla lägenhet hos oss skall du ha inkomst av tjänst eller  pension, inga betalningsanmärkningar samt referenser från tidigare  boende. En borgensman kan uppväga bristen på t ex fast arbete eller  referenser från tidigare boenden. Vi gör alltid en individuell prövning  och förbehåller oss rätten att själva välja hyresgäst.</p>
					<p class="p-3 inset-0 drop-shadow-xl">Genom  att fylla i och skicka in en intresseanmälan godkänner du att vi sparar  dina personuppgifter i anmälan. Vi sparar din intresseanmälan i högst  fyra månader, därefter raderas den. Vid erbjudande om lägenheten  genomför vi en kreditupplysning hos ett kreditupplysningsföretag</p>
				</div>

				<div class="order-3 cardcomp flex flex-col items-center gap-4 ">
					<h2 class="text-black text-2xl font-bold  " >Ev. Medsökande</h2>
					<div class='w-full h-full grid grid-cols-2 gap-3 ' >
						<input class="input input-bordered" placeholder="Namn*" name="name" required/>
						<input type="text" id="personal-number" name="personal_number" placeholder="YYYYMMDDXXXX*" class="input input-bordered" pattern="\d{10}|\d{12}" required>
						<input class="input input-bordered col-span-2" placeholder="E-post*" name="email" type="email" required/>
						<input class="input input-bordered" placeholder="Nuvarande bostadsadress*" name="adress" required/>
						<input class="input input-bordered" placeholder="Nuvarande hyresvärd" name="landlord" />
						<input class="input input-bordered" placeholder="Syselsettning*" name="employment" required/>
						<input class="input input-bordered" placeholder="Arbetsgivare" name="employer" type="text" />
						<input class="input input-bordered" placeholder="Telefon*" name="phone" type="phonenumber" required/>
						<input class="input input-bordered" placeholder="Tel Arbetsgivare" name="phone_employer" type="text"/>
					</div>
				</div>

				<div class="order-4 cardcomp flex flex-col items-center gap-4 ">
					<h2 class="text-black text-2xl font-bold  " >Önskemål beträffande bostad</h2>
					<div class='w-full h-full flex flex-col gap-3 ' >

						<div>
							<label>Antal rum*</label>
							<div class="flex flex-row justify-evenly form-control">

								<label class="cursor-pointer flex flex-row gap-2 label">
									<span class="label-text">Etta</span>
									<input type="checkbox" name="size" id="1" value="Etta" class="checkbox checkbox-primary" />
								</label>
								<label class="cursor-pointer flex flex-row gap-2 label">
									<span class="label-text">Tvåa</span>
									<input type="checkbox" name="size" id="2" value="Tvåa" class="checkbox checkbox-primary" />
								</label>
								<label class="cursor-pointer flex flex-row gap-2 label">
									<span class="label-text">Trea</span>
									<input type="checkbox" name="size" id="3" value="Trea" class="checkbox checkbox-primary" />
								</label>
								<label class="cursor-pointer flex flex-row gap-2 label">
									<span class="label-text">Fyra</span>
									<input type="checkbox" name="size" id="4" value="Fyra" class="checkbox checkbox-primary" />
								</label>
								<label class="cursor-pointer flex flex-row gap-2 label">
									<span class="label-text">Större</span>
									<input type="checkbox" name="size" id="bigger" value="Större" class="checkbox checkbox-primary" />
								</label>
							</div>
						</div>

						<div class="flex flex-col" >
							<label>Inflyttningsdatum*</label>
							<input id="inflyttning" class="input input-bordered" placeholder="Inflyttningsdatum*" name="movein" type="date" />
						</div>

						<div>
							<label>Stad*</label>
							<div class="flex flex-row form-control">
								{% for city in cities %}
								<label class="cursor-pointer flex flex-row gap-2 label">
									<span class="label-text">{{city.1}}</span>
									<input type="checkbox" value="{{city.0}}" id="{{city.1}}" name="city" class="checkbox checkbox-primary" />
								</label>
								{% endfor %}
							</div>
						</div>

						<div hx-get="/buildings/select_areas/with_all" hx-target="this" hx-swap="outerHTML" hx-trigger="load" ></div>

						<textarea name="other" rows="" cols="" placeholder="Övrigt" class="w-full textarea textarea-bordered"></textarea>

						<button type="submit" class="btn btn-primary" >
							Skicka intresseanmälan
						</button>
					</div>
				</div>
			</div>
		</fom>
	</div>
	{% if success %}
		{% include "components/Alert.html" with type="success" msg="Intresseanmälan har skickats!" under=True %}
	{% endif %}
	{% if error %}
		{% include "components/Alert.html" with type="error" msg="{{error}}" under=True %}
	{% endif %}
</div>

<script type="text/javascript">
        function getQueryParams() {
            const queryString = window.location.search;
            const params = {};

            if (queryString) {
                const query = queryString.substring(1);
                const pairs = query.split("&");

                pairs.forEach(pair => {
                    const [key, value] = pair.split("=");
                    params[decodeURIComponent(key)] = decodeURIComponent(value);
                });
            }

            return params;
        }

        function updateElements() {
            const params = getQueryParams();

            if (params["rum"]) {
                const value = params["rum"];
                let element = document.querySelector(`input[type="checkbox"][id="${value}"]`);
                if (element) {
                    element.checked = true;
                }
            }

            if (params["inflyttning"]) {
                document.getElementById("inflyttning").value = new Date(params['inflyttning']).toISOString().split('T')[0];
            }

            if (params["stad"]) {
                document.getElementById(params["stad"]).checked = true;
            }

            if (params["omrade"]) {
                document.getElementById("select_areas").value = params["omrade"];
            }
        }

        // Listen for the HTMX afterOnLoad event
        document.body.addEventListener('htmx:afterOnLoad', function(evt) {
            updateElements();
        });

        // Run once on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateElements();
        });
</script>
